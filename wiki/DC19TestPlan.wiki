#summary Notes on stripping back data and expected results and outcomes
#labels DC19

= Introduction =

A list of things to do and/or check when deploying or retesting this system.


== Fedora ==

Fedora stores data simultaneously in the relational and pairtree databases. Both of these need to be cleared in order to purge the system of records.

The fedora applicaion should not be running when the procedure is carried out if you don't want to see hundreds of null pointer exceptions in your servlet handler logs.

=== Database ===

Issuing the following sequence of commands from with the DBMS will purge the database of records:

{{{
use database fedora3;
truncate doFields;
truncate doRegistry;
truncate pidGen;
}}}

=== Disk ===

The following commands will purge the pairtree and resourceIndex.

{{{
cd $FEDORA_HOME/data
rm -rf /activemq-data/*
rm -rf /datastreamStore/*
rm -rf /resourceIndex/* 
}}}

== Result testing ==

=== Sample test package ===

Currently, a test deposit should contain the following:

 * A boss.xml file containing a response from the RLI booking system.
 * A corresponding dataset file (dset, vamas, itm/ita, etc).

=== local ingest (Sword/Fedora) ===

==== Sword ingest ====

By default (and if no mets.xml is present in the injest package), Sword generates something similar to the following in the DC stream:

{{{
<oai_dc:dc xmlns:oai_dc="http://www.openarchives.org/OAI/2.0/oai_dc/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.openarchives.org/OAI/2.0/oai_dc/ http://www.openarchives.org/OAI/2.0/oai_dc.xsd">
  <dc:title>Uploaded by the JISC funded SWORD project</dc:title>
  <dc:creator>fedoraAdmin</dc:creator>
  <dc:format>application/zip</dc:format>
  <dc:identifier>namespace:entryNumber/dc:identifier>
</oai_dc:dc>
}}}

Note that this data is not used by the CMSS system, but is used to generate the initial fox-ml record in Fedora.

==== Fedora ingest ====

Fedora's primary role in this system is simply that of an object database, with the addition of JMS's notificaiton system. Messages from JMS trigger crosswalks.

=== crosswalks ===

==== ingest-handler ====

This crosswalk performs the following roles:

 * Generate a handle (from hdl.handle.net) 
 * add 'handle' stream to the record

 * retrieve data from boss.xml 
 * convert it into 'dataset' format
 * add 'dataset' stream to the record

 * recognise file types (eg. .itm, .dset, .vms)
 * add appropriate tags so other crosswalks can handle these files

==== metadata-update-handler ====

This crosswalk performs the following roles:

 * generate and test RIF-CS output
 * send RIF-CS to ANDS metadata store
 * add 'rif-cs' stream to the record

 * convert rif-cs to OAI_DC 
 * replace existing DC stream

 * convert fox-ml to solr record
 * push solr record to solr indexer
 * add 'solr' stream to the record

==== vamas-update-handler ====

This crosswalk performs the following roles:

 * push vamas file to Java XML converter
 * add resulting 'vamas-xml' stream to the record

==== surfacelab-update-handler ====

This crosswalk performs the following roles:

 * push .itm file to Java XML converter
 * add resulting 'surfacelab-xml' stream to the record