<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
	<head>
		<title>Fedora Update Handler</title>
		<style type="text/css">
			h1, h2 {
				margin-top: 1.2em;
				margin-bottom: 0.6em;
				font-family: sans-serif;
				color: #405469;
			}

			h2 {
				font-weight: normal;
			}
			
			a {
				color: #1464B7;
				text-decoration: none;
				border-bottom-style: dotted;
				border-bottom-width: 1px;
				border-bottom-color: #1464B7;
			}
			
			a:visited {
				color: #172A73;
				border-bottom-color: #172A73; 
			}
			
			.command {
				padding-top: 0.5em;
				padding-bottom: 0.5em;
				padding-left: 1em;
				padding-right: 1em;
				background-color: #D0DFEE;
				border-style: solid;
				border-width: 1px;
				border-color: #405469;
				width: 50em;
			}
			
		</style>
	</head>
	<body>
		<h1>Fedora Update Handler</h1>
		<h2>Purpose</h2>
		<p>Fedora Update Handler is a Java application for receiving and acting on notifications of updates to a <a href="http://fedora-commons.org/">Fedora Commons</a> repository.</p>
		<p>The Fedora Update Handler may be used to keep other information systems up to date with the latest information present in the Fedora repository. For instance, the updated content may be indexed in a discovery system or replicated into another repository. The updated content might be validated or checksummed, or cross-walked or otherwise transformed. For instance, a datastream might be cross-walked into another format and the resulting document written back to the Fedora object as another datastream.</p>
		<h2>How it works</h2>
		<p>When the Fedora Update Handler program starts, it connects to Fedora and subscribes to notification messages via the <a href="http://en.wikipedia.org/wiki/Java_Message_Service">Java Message Service (JMS)</a>. Then, whenever a datastream in the repository is changed, Fedora sends a message, in the form of an <a href="http://en.wikipedia.org/wiki/Atom_%28standard%29">Atom</a> XML document, to the Fedora Update Handler application. In turn, the Fedora Update Handler application executes a user-specified external program, and passes the Atom message to that program via its standard input stream. The Fedora Update Handler is therefore a bridge between JMS and arbitrary console applications.</p>
		<h2>How to get the application</h2>
		<p>Use <a href="http://subversion.apache.org/">Subversion</a> to check out the Fedora Update Handler source code from the project's source code repository:</p>
		<p class="command"><kbd>svn checkout http://ands-la-trobe.googlecode.com/svn/trunk/fedora-update-handler fedora-update-handler</kbd></p>
		<h2>How to build the application</h2>
		<p>First you will need to have installed <a href="http://www.java.com/en/download/manual.jsp">Java</a> version 1.5 or later, and <a href="http://ant.apache.org/bindownload.cgi">Apache Ant</a>. </p>
		<p>Navigate into the folder and invoke the Ant tool to build the application:</p>
		<div class="command">
			<p><kbd>cd fedora-update-handler</kbd></p>
			<p><kbd>ant</kbd></p>
		</div>
		<p>Ant will execute the <code>build.xml</code> file to build the application, which will be output to <code>build/fedora-update-handler.jar</code></p>
		<h2>How to run the application</h2>
		<p>The application should be run on the same host as the Fedora service itself. </p>
		<p>You will need to <a href="https://wiki.duraspace.org/display/FCR30/Messaging#Messaging-config">enable Fedora's message service</a>.</p>
		<p>You will need to copy the <code>fedora-update-handler.jar</code> into a folder along with all the jars in the <code>lib</code> folder.</p>
		<p>To run the application:</p>
<p>FedoraUpdateHandler expects either one or two parameters:</p>
<ol>
	<li>The first parameter is either 'start' or 'stop' to control the listener.</li>
	<li>The second (and optional) parameter is the name of a Java properties XML file to configure the listener.</li>
</ol>
<p>e.g.</p>
<p class="command">java -jar FedoraUpdateHandler.jar start handle-ingest.xml</p>
<p class="command">java -jar FedoraUpdateHandler.jar start handle-dc-update.xml</p>
<p class="command">java -jar FedoraUpdateHandler.jar stop handle-dc-update.xml</p>
<p>The following properties are documented at https://wiki.duraspace.org/display/FCR30/Messaging</p>
<ul>
	<li>java.naming.factory.initial</li>
	<li>java.naming.provider.url</li>
	<li>connection.factory.name</li>
	<li>topic.fedora</li>
<ul>
<p>The property "handler.jms.clientid" identifies the listener to Fedora. This value must be unique (i.e. each simultaneous client must use a different value for this property).</p>
<p>The property "handler.command" specifies the application which the listener will run to handle the event.
FedoraUpdateHandler will execute this application and pipe the Fedora message (an Atom XML document)
to the application's standard input stream. </p>
<p>Any properties not defined in the properties file will use defaults as shown below:</p>
<![CDATA[
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<properties version="1.0">
	<entry key="java.naming.factory.initial">org.apache.activemq.jndi.ActiveMQInitialContextFactory</entry>
	<entry key="java.naming.provider.url">failover://tcp://localhost:61616</entry>
	<entry key="connection.factory.name">ConnectionFactory</entry>
	<entry key="topic.fedora">fedora.apim.update</entry>
	<entry key="handler.jms.clientid">FedoraUpdateHandler</entry>
	<entry key="handler.command">cat</entry>
</properties>
]]>
<p>Obsolete docs follow:</p>
		<p class="command"><kbd>java -jar fedora-update-handler.jar</kbd> <var>command-line to execute to handle message</var></p>
		<p>The fedora-update-handler application will connect to Fedora and subscribe to update notifications. When a notification message is received, the application will execute the specified command, and pass the notification message to it as the standard input stream.</p>
		<p>For instance, to forward the notifications by email, using the <var>email</var> program, you might enter the following command:</p>
		<p class="command"><kbd>java -jar fedora-update-handler.jar</kbd> <var>mail -s 'Fedora Update Notification' address@example.com</var></p>
	</body>
</html>
